---
title: "Sample Size"
author: "yuki"
date: "2023-03-20"
output: html_document
---

```{r setup, include=FALSE}
#Computation of minimum sample size for test of fit 
rmsea0 <- 0.05 #null hypothesized RMSEA 
rmseaa <- 0.08 #alternative hypothesized RMSEA 0.01为样本最大值，0.08为样本最小值
d <- 292 #degrees of freedom 需要填写
alpha <- 0.05 #alpha level 
desired <- 0.8 #desired power
#请勿修改 
#initialize values 
pow <- 0.0 
n <- 0 
#begin loop for finding initial level of n 
while (pow<desired) { 
  n <- n+100 
  ncp0 <- (n-1)*d*rmsea0^2 
  ncpa <- (n-1)*d*rmseaa^2 
  #compute power 
  if(rmsea0<rmseaa) { 
      cval <- qchisq(alpha,d,ncp=ncp0,lower.tail=F) 
      pow <- pchisq(cval,d,ncp=ncpa,lower.tail=F) 
  } 
  else { 
      cval <- qchisq(1-alpha,d,ncp=ncp0,lower.tail=F) 
      pow <- 1-pchisq(cval,d,ncp=ncpa,lower.tail=F) 
  } 
} 
#begin loop for interval halving 
foo <- -1 
newn <- n 
interval <- 200 
powdiff <- pow - desired 
while (powdiff>.001) { 
  interval <- interval*.5 
  newn <- newn + foo*interval*.5 
  ncp0 <- (newn-1)*d*rmsea0^2 
  ncpa <- (newn-1)*d*rmseaa^2 
  #compute power 
  if(rmsea0<rmseaa) { 
      cval <- qchisq(alpha,d,ncp=ncp0,lower.tail=F) 
      pow <- pchisq(cval,d,ncp=ncpa,lower.tail=F) 
  } 
  else { 
      cval <- qchisq(1-alpha,d,ncp=ncp0,lower.tail=F) 
      pow <- 1-pchisq(cval,d,ncp=ncpa,lower.tail=F) 
  } 
  powdiff <- abs(pow-desired) 
  if (pow<desired) { 
    foo <- 1 
  } 
  if (pow>desired) { 
    foo <- -1 
  } 
} 
minn <- newn 
print(minn)

rm(alpha, cval, d, desired, foo, interval, minn, n, ncp0, ncpa, newn, pow, powdiff, rmsea0, rmseaa)
```
